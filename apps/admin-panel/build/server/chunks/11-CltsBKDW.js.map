{"version":3,"file":"11-CltsBKDW.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/admin/setting/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/11.js"],"sourcesContent":["import \"../../../../chunks/config.js\";\nimport { c as currencyPrefix } from \"../../../../chunks/currency.formatter.js\";\nimport { PrismaClientKnownRequestError } from \"@prisma/client/runtime/library\";\nimport { f as fail } from \"../../../../chunks/index.js\";\nimport { hash } from \"bcrypt\";\nimport { r as redisClient } from \"../../../../chunks/redis.js\";\nimport { config } from \"@backtix-service/config\";\nconst load = async ({ locals }) => {\n  const withdrawFee = {\n    id: 0,\n    amount: Number(\n      await redisClient.get(config.withdraw.feeKey) ?? (await prisma.withdrawFee.findFirst({ where: { id: 0 } })).amount\n    )\n  };\n  return { myUser: locals.user, withdrawFee, currencyPrefix };\n};\nconst actions = {\n  updateFee: async ({ request }) => {\n    const { fee } = Object.fromEntries(await request.formData());\n    try {\n      const adminFee = await prisma.withdrawFee.upsert({\n        create: { amount: Number(fee) },\n        update: { amount: { set: Number(fee) } },\n        where: { id: 0 }\n      });\n      await redisClient.set(config.withdraw.feeKey, adminFee.amount);\n      return { success: true, message: \"Update fee successful\" };\n    } catch (e) {\n      console.error(e);\n      return fail(500, { success: false, message: \"Unknown error\" });\n    }\n  },\n  updateMyProfile: async ({ request, locals }) => {\n    const form = Object.fromEntries(await request.formData());\n    const { confirm_password, password, ...data } = form;\n    try {\n      if (confirm_password !== password) {\n        return fail(400, {\n          success: false,\n          message: \"Password confirmation doesn't match\",\n          ...form\n        });\n      }\n      locals.user = await prisma.user.update({\n        where: { id: locals.user.id },\n        data: {\n          ...data,\n          password: password ? await hash(password, config.security.bcryptSaltOrRound) : void 0\n        }\n      });\n      return { success: true, message: \"Profile edit success.\" };\n    } catch (e) {\n      if (e instanceof PrismaClientKnownRequestError && e.code === \"P2002\") {\n        return fail(409, { success: false, message: \"Username/Email has been registered\", ...form });\n      }\n      console.error(e);\n      return fail(500, { success: false, message: \"Unknown error\", ...form });\n    }\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/admin/setting/_page.server.ts.js';\n\nexport const index = 11;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/admin/setting/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/admin/setting/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/11.CTr_wiph.js\",\"_app/immutable/chunks/scheduler.DFZBBKhI.js\",\"_app/immutable/chunks/index.LUCKkj9k.js\",\"_app/immutable/chunks/BreadcrumbItem.ByMeSVu4.js\",\"_app/immutable/chunks/bundle-mjs.CuhWIVwh.js\",\"_app/immutable/chunks/Button.CrNIN95s.js\",\"_app/immutable/chunks/InputAddon.CyuPLKwj.js\",\"_app/immutable/chunks/Input.DjV6Ntai.js\",\"_app/immutable/chunks/Wrapper.Dkm7VoO3.js\",\"_app/immutable/chunks/Label.CF2lxgNY.js\",\"_app/immutable/chunks/Toast.CwzxZqjj.js\",\"_app/immutable/chunks/CloseButton.vrK9mPVw.js\",\"_app/immutable/chunks/Frame.DNz3Vx4g.js\",\"_app/immutable/chunks/Heading.BXZJ_QtE.js\",\"_app/immutable/chunks/CheckSolid.BTWMbPVw.js\",\"_app/immutable/chunks/CloseSolid.Dk3EYOZw.js\",\"_app/immutable/chunks/GearSolid.CUVhuRwp.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":["config","hash"],"mappings":"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"}