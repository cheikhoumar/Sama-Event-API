{"version":3,"file":"17-CZ1ixf1T.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/auth/email/otp/_page.ts.js","../../../.svelte-kit/adapter-node/entries/pages/auth/email/otp/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/17.js"],"sourcesContent":["const load = async (event) => {\n  return { email: event.url.searchParams.get(\"email\") };\n};\nexport {\n  load\n};\n","import \"../../../../../chunks/config.js\";\nimport { r as redisClient } from \"../../../../../chunks/redis.js\";\nimport { f as fail, r as redirect } from \"../../../../../chunks/index.js\";\nimport jwt from \"jsonwebtoken\";\nimport { config } from \"@backtix-service/config\";\nconst load = async () => {\n  return {};\n};\nconst actions = {\n  default: async (event) => {\n    const data = await event.request.formData();\n    const otp = data.get(\"otp\");\n    if (!otp || otp.length < 6) {\n      return fail(400, { message: \"OTP length must be 6 character\" });\n    }\n    try {\n      const response = await event.fetch(`${config.server.baseUrl}api/auth/admin/login`, {\n        method: \"PATCH\",\n        headers: {\n          \"content-type\": \"application/json\",\n          \"user-agent\": \"Admin-Panel\"\n        },\n        body: JSON.stringify({ otp })\n      });\n      const json = await response.json();\n      if (response.status > 299) return fail(json.statusCode, { message: json.message });\n      const { sub } = jwt.verify(json.refreshToken, config.security.refreshTokenKey);\n      await redisClient.set(json.refreshToken, JSON.stringify({ id: sub }), {\n        EX: config.security.refreshTokenTTL\n      });\n      event.cookies.set(\"refreshToken\", json.refreshToken, {\n        httpOnly: true,\n        maxAge: 60 * 60 * 24 * 30,\n        sameSite: \"strict\",\n        path: \"/\"\n      });\n      event.cookies.set(\"accessToken\", json.accessToken, {\n        httpOnly: true,\n        maxAge: 60 * 60 * 24,\n        sameSite: \"strict\",\n        path: \"/\"\n      });\n    } catch (e) {\n      console.error(e);\n      return fail(500, { message: \"Unknown Error\" });\n    }\n    return redirect(303, \"/admin\");\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as universal from '../entries/pages/auth/email/otp/_page.ts.js';\nimport * as server from '../entries/pages/auth/email/otp/_page.server.ts.js';\n\nexport const index = 17;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/auth/email/otp/_page.svelte.js')).default;\nexport { universal };\nexport const universal_id = \"src/routes/auth/email/otp/+page.ts\";\nexport { server };\nexport const server_id = \"src/routes/auth/email/otp/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/17.C_wnH3fR.js\",\"_app/immutable/chunks/scheduler.DFZBBKhI.js\",\"_app/immutable/chunks/index.LUCKkj9k.js\",\"_app/immutable/chunks/Alert.BGCmzfzt.js\",\"_app/immutable/chunks/bundle-mjs.CuhWIVwh.js\",\"_app/immutable/chunks/CloseButton.vrK9mPVw.js\",\"_app/immutable/chunks/Frame.DNz3Vx4g.js\",\"_app/immutable/chunks/Button.CrNIN95s.js\",\"_app/immutable/chunks/Label.CF2lxgNY.js\",\"_app/immutable/chunks/Input.DjV6Ntai.js\",\"_app/immutable/chunks/Wrapper.Dkm7VoO3.js\",\"_app/immutable/chunks/A.DUGD9iSR.js\",\"_app/immutable/chunks/ArrowLeftSolid.DiL8lSSI.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":["load","config"],"mappings":";;;;;;;;;;;;;AAAA,MAAMA,MAAI,GAAG,OAAO,KAAK,KAAK;AAC9B,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,CAAC,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE,CAAC;AACxD,CAAC;;;;;;;ACGD,MAAM,IAAI,GAAG,YAAY;AACzB,EAAE,OAAO,EAAE,CAAC;AACZ,CAAC,CAAC;AACF,MAAM,OAAO,GAAG;AAChB,EAAE,OAAO,EAAE,OAAO,KAAK,KAAK;AAC5B,IAAI,MAAM,IAAI,GAAG,MAAM,KAAK,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;AAChD,IAAI,MAAM,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AAChC,IAAI,IAAI,CAAC,GAAG,IAAI,GAAG,CAAC,MAAM,GAAG,CAAC,EAAE;AAChC,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,gCAAgC,EAAE,CAAC,CAAC;AACtE,KAAK;AACL,IAAI,IAAI;AACR,MAAM,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,KAAK,CAAC,CAAC,EAAEC,oBAAM,CAAC,MAAM,CAAC,OAAO,CAAC,oBAAoB,CAAC,EAAE;AACzF,QAAQ,MAAM,EAAE,OAAO;AACvB,QAAQ,OAAO,EAAE;AACjB,UAAU,cAAc,EAAE,kBAAkB;AAC5C,UAAU,YAAY,EAAE,aAAa;AACrC,SAAS;AACT,QAAQ,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;AACrC,OAAO,CAAC,CAAC;AACT,MAAM,MAAM,IAAI,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;AACzC,MAAM,IAAI,QAAQ,CAAC,MAAM,GAAG,GAAG,EAAE,OAAO,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE,OAAO,EAAE,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC;AACzF,MAAM,MAAM,EAAE,GAAG,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,EAAEA,oBAAM,CAAC,QAAQ,CAAC,eAAe,CAAC,CAAC;AACrF,MAAM,MAAM,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,EAAE,EAAE,GAAG,EAAE,CAAC,EAAE;AAC5E,QAAQ,EAAE,EAAEA,oBAAM,CAAC,QAAQ,CAAC,eAAe;AAC3C,OAAO,CAAC,CAAC;AACT,MAAM,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,IAAI,CAAC,YAAY,EAAE;AAC3D,QAAQ,QAAQ,EAAE,IAAI;AACtB,QAAQ,MAAM,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE;AACjC,QAAQ,QAAQ,EAAE,QAAQ;AAC1B,QAAQ,IAAI,EAAE,GAAG;AACjB,OAAO,CAAC,CAAC;AACT,MAAM,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE,IAAI,CAAC,WAAW,EAAE;AACzD,QAAQ,QAAQ,EAAE,IAAI;AACtB,QAAQ,MAAM,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE;AAC5B,QAAQ,QAAQ,EAAE,QAAQ;AAC1B,QAAQ,IAAI,EAAE,GAAG;AACjB,OAAO,CAAC,CAAC;AACT,KAAK,CAAC,OAAO,CAAC,EAAE;AAChB,MAAM,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AACvB,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,eAAe,EAAE,CAAC,CAAC;AACrD,KAAK;AACL,IAAI,OAAO,QAAQ,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;AACnC,GAAG;AACH,CAAC;;;;;;;;AC7CW,MAAC,KAAK,GAAG,GAAG;AACxB,IAAI,eAAe,CAAC;AACR,MAAC,SAAS,GAAG,YAAY,eAAe,KAAK,CAAC,MAAM,OAAO,4BAAiD,CAAC,EAAE,QAAQ;AAEvH,MAAC,YAAY,GAAG,qCAAqC;AAErD,MAAC,SAAS,GAAG,4CAA4C;AACzD,MAAC,OAAO,GAAG,CAAC,qCAAqC,CAAC,6CAA6C,CAAC,yCAAyC,CAAC,yCAAyC,CAAC,8CAA8C,CAAC,+CAA+C,CAAC,yCAAyC,CAAC,0CAA0C,CAAC,yCAAyC,CAAC,yCAAyC,CAAC,2CAA2C,CAAC,qCAAqC,CAAC,kDAAkD,EAAE;AAClkB,MAAC,WAAW,GAAG,GAAG;AAClB,MAAC,KAAK,GAAG;;;;"}