{"version":3,"file":"13-iLakT0_7.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/admin/user/new/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/13.js"],"sourcesContent":["import \"../../../../../chunks/config.js\";\nimport { PrismaClientKnownRequestError } from \"@prisma/client/runtime/library\";\nimport { e as error, f as fail, r as redirect } from \"../../../../../chunks/index.js\";\nimport { hash } from \"bcrypt\";\nimport { config } from \"@backtix-service/config\";\nconst load = async ({ locals }) => {\n  if (!locals.user.groups.some((v) => v === \"SUPERADMIN\" || v === \"ADMIN\")) {\n    throw error(403, \"Forbidden\");\n  }\n  return { my: locals.user };\n};\nconst actions = {\n  default: async ({ request }) => {\n    const { password, confirm_password, ...form } = Object.fromEntries(\n      await request.formData()\n    );\n    const { group, activate, ...data } = form;\n    try {\n      if (confirm_password !== password) {\n        return fail(400, {\n          success: false,\n          message: \"Password confirmation doesn't match\",\n          ...form\n        });\n      }\n      const groups = group ? group.split(\",\") : void 0;\n      await prisma.user.create({\n        data: {\n          ...data,\n          groups,\n          activated: activate === \"true\",\n          password: await hash(password, config.security.bcryptSaltOrRound)\n        }\n      });\n    } catch (e) {\n      if (e instanceof PrismaClientKnownRequestError && e.code === \"P2002\") {\n        return fail(409, { success: false, message: \"Username/Email has been registered\", ...form });\n      }\n      console.error(e);\n      return fail(500, { success: false, message: \"Unknown error\", ...form });\n    }\n    return redirect(303, encodeURI(\"/admin/user?success=true&message=New User Added Succesfully\"));\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/admin/user/new/_page.server.ts.js';\n\nexport const index = 13;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/admin/user/new/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/admin/user/new/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/13.CoI5pXVu.js\",\"_app/immutable/chunks/scheduler.DFZBBKhI.js\",\"_app/immutable/chunks/index.LUCKkj9k.js\",\"_app/immutable/chunks/Alert.BGCmzfzt.js\",\"_app/immutable/chunks/bundle-mjs.CuhWIVwh.js\",\"_app/immutable/chunks/CloseButton.vrK9mPVw.js\",\"_app/immutable/chunks/Frame.DNz3Vx4g.js\",\"_app/immutable/chunks/BreadcrumbItem.ByMeSVu4.js\",\"_app/immutable/chunks/Button.CrNIN95s.js\",\"_app/immutable/chunks/InputAddon.CyuPLKwj.js\",\"_app/immutable/chunks/Input.DjV6Ntai.js\",\"_app/immutable/chunks/Wrapper.Dkm7VoO3.js\",\"_app/immutable/chunks/Checkbox.8zBQxmcH.js\",\"_app/immutable/chunks/Label.CF2lxgNY.js\",\"_app/immutable/chunks/Heading.BXZJ_QtE.js\",\"_app/immutable/chunks/P.CQZbmQ1E.js\",\"_app/immutable/chunks/UserSolid.BRLQT1-W.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":["hash","config"],"mappings":"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"}